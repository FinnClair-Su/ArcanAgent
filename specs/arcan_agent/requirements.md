# ArcanAgent 需求文档

## 介绍

ArcanAgent是一个基于"双向链接就是你需要的一切"理念的个人知识管理和学习系统。该系统通过纯markdown文件和双向链接构建知识库-记忆统一架构，结合学习科学原理，为用户提供智能化的学习指导和内容生成服务。系统采用流水线式Agent协作模式，覆盖从需求分析到记忆巩固的完整学习流程。

## 需求

### 需求1 - 知识状态评估与确认

**用户故事：** 作为学习者，我希望系统能够准确评估我当前的知识状态，并与我确认评估结果，以便制定合适的学习计划。

#### 验收标准

1. When 用户启动学习流程时，ArcanAgent shall 分析用户现有的markdown笔记，包括笔记内容、标签、双向链接关系来评估用户的知识状态。
2. When 完成知识状态分析后，ArcanAgent shall 向用户展示评估结果，包括已掌握的概念、知识边界和潜在的学习需求。
3. When 用户查看评估结果时，ArcanAgent shall 提供确认或修正评估的交互界面，允许用户调整评估结果。
4. When 用户确认评估结果后，ArcanAgent shall 保存确认后的知识状态作为后续学习规划的基础。

### 需求2 - 最近发展区识别与学习路径规划

**用户故事：** 作为学习者，我希望系统能够基于维果茨基最近发展区理论，为我规划个性化的学习路径。

#### 验收标准

1. While 基于已确认的知识状态，when 用户请求学习规划时，ArcanAgent shall 识别用户的最近发展区，找出当前可学习但需要支架的概念。
2. When 识别出最近发展区后，ArcanAgent shall 基于双向链接的密度和路径分析，生成从当前知识到目标知识的最优学习序列。
3. When 生成学习路径时，ArcanAgent shall 考虑概念的内在复杂度（存储在笔记元数据中）和用户的认知负荷承受能力。
4. When 学习路径确定后，ArcanAgent shall 向用户展示清晰的学习路径图，包括每个学习节点的预期难度和前置要求。

### 需求3 - 智能上下文选择与内容生成

**用户故事：** 作为学习者，我希望系统能够智能地选择相关上下文，并生成高质量的学习内容。

#### 验收标准

1. When 需要生成学习内容时，ArcanAgent shall 首先根据标签匹配筛选相关笔记，然后将所有笔记摘要提供给LLM进行相关性分析。
2. When 分析笔记相关性后，ArcanAgent shall 采用分层上下文策略：最相关笔记附上全文、中等相关笔记附上摘要、低相关笔记仅附上标题和链接。
3. When 生成学习内容时，ArcanAgent shall 创建符合用户学习模式和偏好的个性化内容，并实时创建与现有知识的双向链接。
4. When 创建双向链接时，ArcanAgent shall 确保链接的语义准确性和学习价值，避免过度链接或无意义链接。

### 需求4 - 理解程度检测

**用户故事：** 作为学习者，我希望系统能够检测我对学习内容的理解程度，并提供针对性的反馈。

#### 验收标准

1. When 用户完成学习内容阅读后，ArcanAgent shall 通过多样化的检测方式（如概念解释、举例说明、关联分析）评估用户的理解程度。
2. When 检测到理解不足时，ArcanAgent shall 提供额外的解释、类比或练习来帮助用户达到理解目标。
3. When 用户表现出良好理解时，ArcanAgent shall 记录理解状态并更新用户的知识图谱。
4. When 理解检测完成后，ArcanAgent shall 根据检测结果调整后续学习内容的难度和重点。

### 需求5 - 记忆巩固与知识整合

**用户故事：** 作为学习者，我希望系统能够帮助我巩固新学到的知识，并将其整合到现有知识体系中。

#### 验收标准

1. When 用户完成理解检测后，ArcanAgent shall 通过多种方式（如概念图构建、关联思考、应用场景探讨）帮助用户巩固记忆。
2. When 进行记忆巩固时，ArcanAgent shall 利用已建立的双向链接，展示新知识与现有知识的关联，促进知识网络的整合。
3. When 巩固过程完成后，ArcanAgent shall 更新用户的知识库，创建或更新相关的markdown笔记，并建立新的双向链接。
4. When 知识整合完成后，ArcanAgent shall 更新用户的学习档案，记录学习成果和新增的知识节点。

### 需求6 - 独立前端界面

**用户故事：** 作为学习者，我希望有一个直观易用的界面来与ArcanAgent进行交互。

#### 验收标准

1. When 用户访问系统时，ArcanAgent shall 提供清晰直观的Web界面，支持学习流程的各个环节。
2. When 展示知识图谱时，ArcanAgent shall 提供可视化的双向链接网络，支持节点点击、缩放、过滤等交互功能。
3. When 进行学习活动时，ArcanAgent shall 提供专注的学习界面，最小化干扰，优化认知负荷。
4. When 用户需要查看学习进度时，ArcanAgent shall 提供清晰的进度追踪和成就展示功能。

### 需求7 - Obsidian兼容性

**用户故事：** 作为Obsidian用户，我希望ArcanAgent生成的知识库能够与Obsidian完全兼容，方便我进行手动编辑和管理。

#### 验收标准

1. When ArcanAgent创建或更新笔记时，该系统 shall 使用标准的markdown格式和Obsidian兼容的双向链接语法（[[]]）。
2. When 生成知识库文件时，ArcanAgent shall 确保所有文件都是纯文本的markdown文件，可直接在Obsidian中打开和编辑。
3. When 创建元数据时，ArcanAgent shall 使用Obsidian兼容的YAML前言格式存储笔记属性和标签。
4. When 用户在Obsidian中修改笔记后，ArcanAgent shall 能够正确读取和处理修改后的内容，保持系统的一致性。

## 设计约束

### 性能要求
- 系统应支持数千个笔记节点的高效处理
- 响应时间应优化用户体验，充分利用KV-Cache等优化技术
- 支持高并发API调用以提供流畅的交互体验

### 架构约束
- 严格遵循6个上下文工程原则：KV-Cache优化、工具可用性管理、文件系统作为上下文、通过复述引导注意力、错误信息保留、上下文多样性
- 采用流水线式Agent协作架构
- 知识存储完全基于文件系统，不依赖复杂的图数据库或向量存储